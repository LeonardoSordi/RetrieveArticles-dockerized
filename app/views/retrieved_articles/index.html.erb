<!-- app/views/articles/index.html.erb -->

<!DOCTYPE html>
<html lang="">
<head>
  <title>Articles</title>
</head>

<body>

<script>
  //script per l'apertura del popup alla pressione del tasto Delete Article
    document.addEventListener("DOMContentLoaded", function() {
        const deleteButtons = document.querySelectorAll('.delete-article');

        deleteButtons.forEach(button => {
            button.addEventListener('click', function(event) {
                event.preventDefault();
                const articleId = button.dataset.articleId;
                const confirmationModal = document.getElementById('deleteConfirmationModal');
                const confirmationInput = document.getElementById('confirmationInput');
                const confirmDeleteButton = document.getElementById('confirmDeleteButton');

                confirmDeleteButton.onclick = function() {
                    const inputValue = confirmationInput.value.trim();
                    if (inputValue === 'DELETE') {
                        window.location.href = `/articles/${articleId}`;
                    } else {
                        // Handle incorrect input
                        alert('Please type "DELETE" to confirm deletion.');
                        confirmationInput.value = '';
                    }
                };

                confirmationModal.addEventListener('hidden.bs.modal', function() {
                    confirmationInput.value = '';
                });

                // Show modal
                $('#deleteConfirmationModal').modal('show');
            });
        });
    });

</script>


<h1>Articles</h1>
<ul>
  <% @retrieved_articles['articles'].each do |retrieved_article| %>
    <li>
      <!-- Display article -->
      <h2><%= retrieved_article['title'] %></h2>
      <p><%= retrieved_article['body'] %></p>
      <br></br>

      <%= hidden_field_tag "articles[][author_key]", "", id: "author_key_#{retrieved_article['id']}" %>

      <!-- Edit article -->
      <%= button_to "Edit", edit_retrieved_article_path(retrieved_article['id']), class: "btn btn-primary" %>

      <!-- Destroy article -->
      <%= button_to "Delete Article", delete_article_path, method: :delete, params: { article_id: retrieved_article['id']} %>

    </li>
  <% end %>
</ul>

<!-- finestra di popup alla pressione del tasto Delete Article-->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this article?</p>
        <input type="text" id="confirmationInput" class="form-control" placeholder="Type 'DELETE' to confirm">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>

<%= link_to "New Article", new_retrieved_article_path %>

